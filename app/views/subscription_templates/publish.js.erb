// Build the request headers
var headers = new Headers();
headers.append('Content-Type', 'application/json');

// Build the request options
var requestOptions = {
method: 'POST',
headers: headers,
body: '<%= @json_payload.html_safe %>',
redirect: 'follow'
};

// Send the POST request
fetch('<%= @broker_url %>', requestOptions)
.then(response => response.text())
.then(result => {
  console.log(result);

  // Get the notification box
  var notification = document.getElementById('temporaryNotification');

  // Change the text of the notification box
  notification.textContent = "<%= l(:subscription_published) %>";

  // Show the notification box
  notification.classList.add('visible');

  // Hide the notification box after 3 seconds
  setTimeout(function() {
    notification.classList.remove('visible');
  }, 3000);
})
.catch(error => console.log('error', error));
